<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ä—Å—Ä–∏—è–Ω—Å–∫–∏–π —è–∑—ã–∫</title>
    <style>
        :root {
            --primary: #58cc02; /* Duolingo green */
            --primary-dark: #46a302;
            --secondary: #1cb0f6; /* Blue */
            --secondary-dark: #1899d6;
            --danger: #ff4b4b;
            --danger-dark: #d42c2c;
            --gray: #e5e5e5;
            --text: #4b4b4b;
            --white: #ffffff;
            --shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f7f7f7;
            color: var(--text);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- SCREENS --- */
        .screen {
            display: none;
            padding: 20px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            flex-grow: 1;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER & MENU --- */
        header {
            text-align: center;
            padding: 20px 0;
        }

        h1 {
            color: var(--secondary);
            margin-bottom: 30px;
        }

        .menu-grid {
            display: grid;
            gap: 15px;
        }

        .menu-card {
            background: var(--white);
            border: 2px solid var(--gray);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.1s, border-color 0.1s;
            box-shadow: 0 4px 0 var(--gray);
        }

        .menu-card:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .menu-card h3 {
            margin-bottom: 5px;
            color: var(--text);
        }

        .menu-card p {
            color: #777;
            font-size: 0.9em;
        }

        /* --- GAME UI --- */
        .progress-container {
            width: 100%;
            height: 16px;
            background: var(--gray);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-area {
            text-align: center;
            margin-bottom: 30px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .prompt-text {
            font-size: 1.2rem;
            color: #777;
            margin-bottom: 10px;
        }

        .target-word {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 20px;
        }

        /* --- OPTIONS (Standard Quiz) --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-option {
            background: var(--white);
            border: 2px solid var(--gray);
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 0 var(--gray);
            text-align: left;
            position: relative;
        }

        .btn-option:hover {
            background: #f0f0f0;
        }

        .btn-option.selected {
            border-color: var(--secondary);
            background: #e1f5fe;
        }

        /* --- SENTENCE BUILDER --- */
        .sentence-slot-area {
            min-height: 60px;
            border-bottom: 2px solid var(--gray);
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 5px;
            align-items: center;
            justify-content: center;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .word-chip {
            background: var(--white);
            border: 1px solid var(--gray);
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 2px 0 var(--gray);
            user-select: none;
        }

        .word-chip:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* --- SYLLABLE LESSON --- */
        .syllable-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .voice-toggle {
            padding: 5px 10px;
            border: 1px solid var(--secondary);
            border-radius: 20px;
            background: white;
            color: var(--secondary);
            cursor: pointer;
        }
        
        .voice-toggle.active {
            background: var(--secondary);
            color: white;
        }

        .syllable-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .syllable-card {
            aspect-ratio: 1;
            background: white;
            border: 2px solid var(--gray);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 0 var(--gray);
        }
        
        .syllable-card:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .syllable-main {
            font-weight: bold;
            font-size: 1.2rem;
        }
        .syllable-sub {
            font-size: 0.8rem;
            color: #888;
        }

        /* --- FOOTER ACTION BAR --- */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px; /* Increased padding */
            padding-bottom: 40px; /* Extra padding for mobile safe areas */
            background: var(--white);
            border-top: 2px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .action-bar.hidden {
            display: none;
        }

        .action-bar.correct {
            background: #d7ffb8;
            border-color: #b8f28b;
            color: #58a700;
        }

        .action-bar.wrong {
            background: #ffdfe0;
            border-color: #ffb8b8;
            color: #ea2b2b;
        }

        .btn-check {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 4px 0 var(--primary-dark);
            cursor: pointer;
            width: 100%;
            max-width: 200px;
        }

        .btn-check:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        
        .btn-check.secondary {
            background: var(--secondary);
            box-shadow: 0 4px 0 var(--secondary-dark);
        }

        .feedback-msg {
            font-weight: bold;
            font-size: 1.2rem;
            flex-grow: 1;
            margin-right: 20px;
        }

        /* --- CREDIT --- */
        .credit {
            position: fixed;
            bottom: 5px;
            right: 10px;
            font-size: 0.7rem;
            color: #aaa;
            z-index: 200;
            pointer-events: none;
        }

        .audio-btn {
            background: var(--secondary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 10px;
        }

    </style>
</head>
<body>

    <div id="screen-menu" class="screen active">
        <header>
            <h1>–ú–∞—Ä—Å—Ä–∏—è–Ω—Å–∫–∏–π</h1>
        </header>
        <div class="menu-grid">
            <div class="menu-card" onclick="startApp('words')">
                <h3>–°–ª–æ–≤–∞</h3>
                <p>–ë–∞–∑–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å</p>
            </div>
            <div class="menu-card" onclick="startApp('pronunciation')">
                <h3>–ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ</h3>
                <p>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–ª—É—Ö–∞</p>
            </div>
            <div class="menu-card" style="border-color: var(--secondary); box-shadow: 0 4px 0 var(--secondary-dark);" onclick="startApp('sentences')">
                <h3 style="color: var(--secondary)">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
                <p>–ü–µ—Ä–µ–≤–æ–¥</p>
            </div>
            <div class="menu-card" onclick="startApp('lessons')">
                <h3>–£—Ä–æ–∫: –°–ª–æ–≥–∏</h3>
                <p>K, N, M —Å –∞—É–¥–∏–æ</p>
            </div>
        </div>
    </div>

    <div id="screen-quiz" class="screen">
        <button class="back-btn" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="question-area" id="questionArea">
            </div>

        <div class="action-bar" id="actionBar">
            <div class="feedback-msg" id="feedbackMsg"></div>
            <button class="btn-check" id="checkBtn" onclick="checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <button class="btn-check secondary" id="nextBtn" onclick="nextQuestion()" style="display:none">–î–∞–ª–µ–µ</button>
        </div>
    </div>

    <div id="screen-lesson" class="screen">
        <button class="back-btn" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>–°–ª–æ–≥–∏</h2>
        <p style="margin-bottom: 15px; color: #666;">–ù–∞–∂–º–∏ –Ω–∞ —Å–ª–æ–≥, —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å.</p>
        
        <div class="syllable-controls">
            <span>–ì–æ–ª–æ—Å –¥–ª—è K:</span>
            <button class="voice-toggle active" onclick="setVoice('ritsu')" id="voice-ritsu">(1)</button>
            <button class="voice-toggle" onclick="setVoice('nurse')" id="voice-nurse">(2)</button>
        </div>

        <div class="syllable-grid" id="syllableGrid">
            </div>
    </div>

    <div id="screen-results" class="screen" style="text-align: center; justify-content: center;">
        <h2 style="font-size: 2rem; margin-bottom: 20px;">–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
        <p id="resultText" style="font-size: 1.2rem; color: #666; margin-bottom: 40px;"></p>
        <button class="btn-check" onclick="showMenu()">–í –º–µ–Ω—é</button>
    </div>

    <div class="credit">Audio generated by VOICEVOX</div>

    <script>
        // --- DATA ---
        const dictionary = [
            {word: "ma", translation: "—è", transcription: "/ma/"},
            {word: "teu", translation: "—Ç—ã", transcription: "/teu/"},
            {word: "kel", translation: "–æ–Ω, –æ–Ω–∞, –æ–Ω–æ", transcription: "/kel/"},
            {word: "meula", translation: "–º—ã", transcription: "/'meu.la/"},
            {word: "teula", translation: "–≤—ã", transcription: "/'teu.la/"},
            {word: "keula", translation: "–æ–Ω–∏", transcription: "/'keu.la/"},
            {word: "man", translation: "–º–æ–π", transcription: "/man/"},
            {word: "teun", translation: "—Ç–≤–æ–π", transcription: "/teun/"},
            {word: "keun", translation: "–µ–≥–æ, –µ—ë", transcription: "/keun/"},
            {word: "mitan", translation: "–Ω–∞—à", transcription: "/'mi.tan/"},
            {word: "teulan", translation: "–≤–∞—à", transcription: "/'teu.lan/"},
            {word: "keulan", translation: "–∏—Ö", transcription: "/'keu.lan/"},
            {word: "razi", translation: "–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å", transcription: "/…πa.' Éi/"},
            {word: "razila", translation: "–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ª–∏—á–Ω–æ—Å—Ç–∏", transcription: "/…πa.' Éi.la/"},
            {word: "kai", translation: "–∫—Ç–æ", transcription: "/kai/"},
            {word: "kou", translation: "—á—Ç–æ", transcription: "/kou/"},
            {word: "kan", translation: "–≥–¥–µ", transcription: "/kan/"},
            {word: "kas", translation: "–∫–∞–∫", transcription: "/kas/"},
            {word: "kama", translation: "–ø–æ—á–µ–º—É", transcription: "/ka.'ma/"},
            {word: "si", translation: "—ç—Ç–æ", transcription: "/si/"},
            {word: "sen", translation: "—Ç–æ", transcription: "/sen/"},
            {word: "orit", translation: "–∫—Ä–∞—Å–∏–≤—ã–π", transcription: "/o.'…πit/"},
            {word: "moran", translation: "—Ö–æ–ª–æ–¥–Ω—ã–π", transcription: "/mo.'…πan/"},
            {word: "siran", translation: "—Ç–µ–ø–ª—ã–π", transcription: "/si.'…πan/"},
            {word: "teran", translation: "–≥—Ä—è–∑–Ω—ã–π", transcription: "/te.'…πan/"},
            {word: "kleran", translation: "—á–∏—Å—Ç—ã–π", transcription: "/kle.'…πan/"},
            {word: "kaan", translation: "—Å–∏–ª—å–Ω—ã–π", transcription: "/ka:n/"},
            {word: "kinan", translation: "–ª—é–±–∏–º—ã–π", transcription: "/ki.'nan/"},
            {word: "nuitan", translation: "–≥—Ä—É—Å—Ç–Ω—ã–π", transcription: "/nui.'tan/"},
            {word: "sote", translation: "–∑–ª–æ–π", transcription: "/so.'te/"},
            {word: "koutan", translation: "–∂–µ–ª–∞–Ω–Ω—ã–π", transcription: "/kou.'tan/"},
            {word: "upaenan", translation: "–æ—Ç–∫—Ä—ã—Ç—ã–π", transcription: "/u.pae.'nan/"},
            {word: "tsemonan", translation: "–∑–∞–∫—Ä—ã—Ç—ã–π", transcription: "/tse.no.'nan/"},
            {word: "uresan", translation: "—Ä–∞–¥–æ—Å—Ç–Ω—ã–π", transcription: "/u.re.'san/"},
            {word: "kienan", translation: "—É–º–Ω—ã–π", transcription: "/kie.'nan/"},
            {word: "lumenan", translation: "—Å–≤–µ—Ç–ª—ã–π", transcription: "/lu.me.'nan/"},
            {word: "noksan", translation: "—Ç—ë–º–Ω—ã–π", transcription: "/nok.'san/"},
            {word: "kelunan", translation: "—Ö–æ–ª–æ–¥–Ω—ã–π", transcription: "/ke.lu.'nan/"},
            {word: "ites", translation: "–≤–∏–¥–µ—Ç—å", transcription: "/i.'tes/"},
            {word: "kies", translation: "–∑–Ω–∞—Ç—å", transcription: "/kies/"},
            {word: "uoku", translation: "–¥–µ–ª–∞—Ç—å", transcription: "/'uo.ku/"},
            {word: "ipuse", translation: "–∏–¥—Ç–∏", transcription: "/i.pu.'se/"},
            {word: "aulise", translation: "–≥–æ–≤–æ—Ä–∏—Ç—å", transcription: "/au.li.'se/"},
            {word: "kienae", translation: "–∏–º–µ—Ç—å", transcription: "/'kie.nae/"},
            {word: "inase", translation: "—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å", transcription: "/i.na.'se/"},
            {word: "kaese", translation: "–¥—É–º–∞—Ç—å", transcription: "/kae.'se/"},
            {word: "kaina", translation: "–¥–∞–≤–∞—Ç—å", transcription: "/kai.'na/"},
            {word: "sanes", translation: "—Å–ø–∞—Ç—å", transcription: "/sa.'nes/"},
            {word: "koutse", translation: "—Ö–æ—Ç–µ—Ç—å", transcription: "/kou.'tse/"},
            {word: "uimse", translation: "—Å–ª—É—à–∞—Ç—å", transcription: "/uim.'se/"},
            {word: "upaese", translation: "–æ—Ç–∫—Ä—ã–≤–∞—Ç—å", transcription: "/u.pae.'se/"},
            {word: "tsemose", translation: "–∑–∞–∫—Ä—ã–≤–∞—Ç—å", transcription: "/tse.mo.'se/"},
            {word: "iesinse", translation: "–ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å", transcription: "/ie.sin.'se/"},
            {word: "ra", translation: "–¥–∞", transcription: "/…πa/"},
            {word: "ren", translation: "–Ω–µ—Ç", transcription: "/…πen/"},
            {word: "rensu", translation: "–Ω–∞–≤–µ—Ä–Ω–æ–µ", transcription: "/'…πen.su/"},
            {word: "re", translation: "–Ω–µ", transcription: "/…πe/"},
            {word: "ne", translation: "–≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç–∏—Ü–∞", transcription: "/ne/"},
            {word: "en", translation: "–≤, –≤–Ω—É—Ç—Ä–∏", transcription: "/en/"},
            {word: "su", translation: "–Ω–∞, –Ω–∞–¥", transcription: "/su/"},
            {word: "isu", translation: "—Å, –≤–º–µ—Å—Ç–µ", transcription: "/i.'su/"},
            {word: "isuren", translation: "–±–µ–∑", transcription: "/i.'su.…πen/"},
            {word: "til", translation: "–∫, –¥–æ", transcription: "/til/"},
            {word: "e", translation: "–∏", transcription: "/e/"},
            {word: "ora", translation: "–∏–ª–∏", transcription: "/o.'…πa/"},
            {word: "ine", translation: "–Ω–æ", transcription: "/'i.ne/"},
            {word: "kau", translation: "–ø–æ—Ç–æ–º—É —á—Ç–æ", transcription: "/kau/"},
            {word: "ima", translation: "—Å–µ–π—á–∞—Å", transcription: "/i.'ma/"},
            {word: "sora", translation: "—Ç–æ–≥–¥–∞", transcription: "/so.'…πa/"},
            {word: "misa", translation: "–±–æ–ª–µ–µ", transcription: "/mi.'sa/"},
            {word: "mena", translation: "–º–µ–Ω–µ–µ", transcription: "/me.'na/"},
            {word: "mesa", translation: "—Å–∞–º—ã–π", transcription: "/me.'sa/"},
            {word: "ite", translation: "–≤–∏–¥", transcription: "/i.'te/"},
            {word: "kie", translation: "–∑–Ω–∞–Ω–∏–µ", transcription: "/kie/"},
            {word: "kape", translation: "–¥–µ–ª–æ", transcription: "/ka.'pe/"},
            {word: "ina", translation: "—á—É–≤—Å—Ç–≤–æ", transcription: "/i.'na/"},
            {word: "kae", translation: "–º—ã—Å–ª—å", transcription: "/kae/"},
            {word: "sane", translation: "—Å–æ–Ω", transcription: "/sa.'ne/"},
            {word: "uim", translation: "—Å–ª—É—Ö", transcription: "/uim/"},
            {word: "upae", translation: "–æ—Ç–∫—Ä—ã—Ç–∏–µ", transcription: "/u.'pae/"},
            {word: "iesin", translation: "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ", transcription: "/ie.'sin/"},
            {word: "kin", translation: "–ª—é–±–æ–≤—å", transcription: "/kin/"},
            {word: "nuit", translation: "–≥—Ä—É—Å—Ç—å", transcription: "/nuit/"},
            {word: "ka", translation: "—Å–∏–ª–∞", transcription: "/ka/"},
            {word: "kout", translation: "–∂–µ–ª–∞–Ω–∏–µ", transcription: "/kout/"},
            {word: "akua", translation: "–≤–æ–¥–∞", transcription: "/a.'kua/"},
            {word: "tera", translation: "–∑–µ–º–ª—è", transcription: "/te.'…πa/"},
            {word: "mane", translation: "–≤–µ—Ç–µ—Ä", transcription: "/ma.'ne/"},
            {word: "lumen", translation: "—Å–≤–µ—Ç", transcription: "/'lu.men/"},
            {word: "piro", translation: "–æ–≥–æ–Ω—å", transcription: "/pi.'…πo/"},
            {word: "kelu", translation: "–ª—ë–¥", transcription: "/ke.'lu/"},
            {word: "noks", translation: "—Ç—å–º–∞", transcription: "/noks/"},
            {word: "atapo", translation: "–≥–æ–ª–æ–≤–∞", transcription: ""},
            {word: "okulo", translation: "–≥–ª–∞–∑", transcription: ""},
            {word: "neu", translation: "–Ω–æ—Å", transcription: ""},
            {word: "kuzi", translation: "—Ä–æ—Ç", transcription: ""},
            {word: "auri", translation: "—É—Ö–æ", transcription: ""},
            {word: "zila", translation: "—è–∑—ã–∫", transcription: ""},
            {word: "kali", translation: "–≤–æ–ª–æ—Å—ã", transcription: ""},
            {word: "koto", translation: "—Ç–µ–ª–æ", transcription: ""},
            {word: "kanra", translation: "—Å–µ—Ä–¥—Ü–µ", transcription: ""},
            {word: "akro", translation: "–∫—Ä–æ–≤—å", transcription: ""},
            {word: "pan", translation: "—Å–ø–∏–Ω–∞", transcription: ""},
            {word: "zisuto", translation: "–∂–∏–≤–æ—Ç", transcription: ""},
            {word: "ponu", translation: "–∫–æ—Å—Ç—å", transcription: ""},
            {word: "surin", translation: "–∫–æ–∂–∞", transcription: ""},
            {word: "and", translation: "—Ä—É–∫–∞", transcription: ""},
            {word: "ano", translation: "–ø–ª–µ—á–æ", transcription: ""},
            {word: "kar", translation: "–ø–∞–ª–µ—Ü", transcription: ""},
            {word: "itu", translation: "–Ω–æ–≥–∞", transcription: ""},
            {word: "ito", translation: "–∫–æ–ª–µ–Ω–æ", transcription: ""},
            {word: "rons", translation: "–ª–µ–≥–∫–∏–µ", transcription: ""},
            {word: "koutla", translation: "–∂–µ–ª–∞–Ω–∏—è", transcription: "/kout.'la/"},
            {word: "upaela", translation: "–æ—Ç–∫—Ä—ã—Ç–∏—è", transcription: "/u.'pae.la/"},
            {word: "iesinla", translation: "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è", transcription: "/ie.sin.'la/"},
            {word: "sanela", translation: "—Å–Ω—ã", transcription: "/sa.ne.'la/"},
            {word: "kaela", translation: "–º—ã—Å–ª–∏", transcription: "/kae.'la/"},
            {word: "inala", translation: "—á—É–≤—Å—Ç–≤–∞", transcription: "/i.na.'la/"},
            {word: "kiela", translation: "–∑–Ω–∞–Ω–∏—è", transcription: "/kie.'la/"},
            {word: "un", translation: "–æ–¥–∏–Ω", transcription: "/un/"},
            {word: "tuo", translation: "–¥–≤–∞", transcription: "/tuo/"},
            {word: "lei", translation: "—Ç—Ä–∏", transcription: "/lei/"},
            {word: "kuan", translation: "—á–µ—Ç—ã—Ä–µ", transcription: "/kuan/"},
            {word: "kain", translation: "–ø—è—Ç—å", transcription: "/kain/"},
            {word: "zi", translation: "—à–µ—Å—Ç—å", transcription: "/ Éi/"},
            {word: "septem", translation: "—Å–µ–º—å", transcription: "/'sep.tem/"},
            {word: "okuto", translation: "–≤–æ—Å–µ–º—å", transcription: "/o.ku.'to/"},
            {word: "none", translation: "–¥–µ–≤—è—Ç—å", transcription: "/'no.ne/"},
            {word: "ede", translation: "–¥–µ—Å—è—Ç—å", transcription: "/'e.de/"},
            {word: "sent", translation: "—Å—Ç–æ", transcription: "/sent/"},
            {word: "mirle", translation: "—Ç—ã—Å—è—á–∞", transcription: "/'mi…π.le/"},
            {word: "mile", translation: "–º–∏–ª–ª–∏–æ–Ω", transcription: "/'mil.le/"},
            {word: "milione", translation: "–º–∏–ª–ª–∏–∞—Ä–¥", transcription: "/mi.li.'on/"},
            {word: "une", translation: "–ø–µ—Ä–≤—ã–π", transcription: "/'u.ne/"},
            {word: "tuone", translation: "–≤—Ç–æ—Ä–æ–π", transcription: "/'tuo.ne/"},
            {word: "leine", translation: "—Ç—Ä–µ—Ç–∏–π", transcription: "/'lei.ne/"},
            {word: "kuane", translation: "—á–µ—Ç–≤–µ—Ä—Ç—ã–π", transcription: "/'kua.ne/"},
            {word: "kaine", translation: "–ø—è—Ç—ã–π", transcription: "/'kai.ne/"},
            {word: "mi", translation: "–º–Ω–æ–≥–æ", transcription: "/mi/"},
            {word: "me", translation: "–º–∞–ª–æ", transcription: "/me/"},
            {word: "minme", translation: "—Å—Ä–µ–¥–Ω–µ", transcription: "/'min.me/"},
            {word: "rem", translation: "–≤—Å–µ", transcription: "/…πem/"},
            {word: "remu", translation: "–∫–∞–∂–¥—ã–π", transcription: "/'…πe.mu/"},
            {word: "zero", translation: "–Ω–æ–ª—å", transcription: "/' Ée.…πo/"},
            {word: "liu", translation: "–∏–º—è", transcription: "/liu/"},
            {word: "riliu", translation: "—Ñ–∞–º–∏–ª–∏—è", transcription: "/'…πi.liu/"},
            {word: "ini", translation: "–≤–æ–∑—Ä–∞—Å—Ç", transcription: "/i.'ni/"},
            {word: "sutir", translation: "–¥–æ —Å–∏—Ö –ø–æ—Ä", transcription: "/su.'ti…π/"},
            {word: "oruado", translation: "–≤–ø–µ—Ä–µ–¥", transcription: "/o.'…πua.do/"},
            {word: "ako", translation: "–Ω–∞–∑–∞–¥", transcription: "/'a.ko/"},
            {word: "ee", translation: "—ç—Ö", transcription: "/e:/"},
            {word: "ai", translation: "–∞–∞", transcription: "/a:i/"},
            {word: "um", translation: "—É–ø—Å", transcription: "/um/"},
            {word: "ie", translation: "—ç–π", transcription: "/ie/"},
            {word: "m", translation: "–Ω—É", transcription: "/m/"},
            {word: "lala", translation: "–¥–∞ –¥–∞", transcription: "/la…æa/"},
            {word: "to ía", translation: "–≤—É–∞–ª—è", transcription: "/to.' ía:/"},
            {word: "oo", translation: "–æ–≥–æ", transcription: "/o:/"},
            {word: "ilia", translation: "–ò–ª—å—è", transcription: "/ilia/"} 
        ];

        // –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const sentencesData = [
            {
                type: 'audio_choice',
                prompt: '–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?',
                correctText: 'kas teun liu ne?',
                wrongText: 'kas teun lio?',
                correctAudio: 'nameRIGHT',
                wrongAudio: 'nameWRONG'
            },
            {
                type: 'audio_choice',
                prompt: '–ú–æ–µ –∏–º—è –ò–ª—å—è',
                correctText: 'ma liu si ilia',
                wrongText: 'ma liu sen ilia',
                correctAudio: 'iliaRIGHT',
                wrongAudio: 'iliaWRONG'
            },
            {
                type: 'construct',
                prompt: '–ü–µ—Ä–µ–≤–µ–¥–∏: "–Ø —Å –ò–ª—å—ë–π"', // –ò—Å–ø—Ä–∞–≤–∏–ª "–º–æ–µ –∏–º—è –∏–ª—å—è" –Ω–∞ "—è —Å –∏–ª—å–µ–π", —Ç–∞–∫ –∫–∞–∫ –∫–æ–¥ ma isu ilia
                target: ['ma', 'isu', 'ilia'],
                audio: 'withilia' // –ò–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ mp3
            },
            {
                type: 'construct',
                prompt: '–ü–µ—Ä–µ–≤–µ–¥–∏: "Ma isu ilia"',
                target: ['–Ø', '—Å', '–ò–ª—å—ë–π'],
                audio: 'withilia'
            },
            {
                type: 'construct',
                prompt: '–ü–µ—Ä–µ–≤–µ–¥–∏: "Ma liu si ilia"',
                target: ['–º–µ–Ω—è', '–∑–æ–≤—É—Ç', '–ò–ª—å—è'],
                audio: 'iliaRIGHT'
            },
            {
                type: 'construct',
                prompt: '–ü–µ—Ä–µ–≤–µ–¥–∏: "–ú–æ–µ –∏–º—è –ò–ª—å—è"',
                target: ['ma', 'liu', 'si', 'ilia'],
                audio: 'iliaRIGHT'
            }
        ];

        const syllablesData = {
            vowels: ['a', 'i', 'u', 'e', 'o', 'ai', 'iu', 'oi', 'au', 'eu'],
            consonants: ['k', 'n', 'm']
        };

        // --- STATE ---
        let state = {
            mode: null, // 'words', 'sentences', 'lesson'
            queue: [],
            currentIndex: 0,
            score: 0,
            selectedVoice: 'ritsu', // 'ritsu' or 'nurse'
            currentSentenceBuild: [],
            selectedOptionIndex: -1
        };

        // --- AUDIO SYSTEM ---
        function playAudio(filename) {
            let finalFilename = filename;

            // 1. –õ–æ–≥–∏–∫–∞ –¥–ª—è —Å–ª–æ–≥–æ–≤ (K, N, M)
            if (filename.startsWith('k_syllable_')) {
                const vowel = filename.split('_')[2];
                const suffix = state.selectedVoice === 'ritsu' ? '1' : '2';
                finalFilename = 'k' + vowel + suffix;
            } 
            // 2. –õ–æ–≥–∏–∫–∞ —Ä–∞–Ω–¥–æ–º–∞ –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (nameWRONG, nameRIGHT –∏ —Ç.–¥.)
            else {
                // –°–ø–∏—Å–æ–∫ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –¥–≤–µ –≤–µ—Ä—Å–∏–∏ (1 –∏ 2)
                const randomFiles = [
                    'nameRIGHT', 
                    'nameWRONG', 
                    'iliaRIGHT', 
                    'iliaWRONG',
                    'withilia'
                ];

                if (randomFiles.includes(filename)) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ 1 –∏–ª–∏ 2
                    const randomNumber = Math.floor(Math.random() * 2) + 1;
                    finalFilename = filename + randomNumber;
                }
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
            const path = './audio/' + finalFilename + '.wav';
            
            console.log("–ò–≥—Ä–∞—é —Ñ–∞–π–ª:", path); // –ß—Ç–æ–±—ã —Ç—ã –≤–∏–¥–µ–ª –≤ –∫–æ–Ω—Å–æ–ª–∏ –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —Ñ–∞–π–ª –≤—ã–±—Ä–∞–ª—Å—è

            const audio = new Audio(path);
            audio.play().catch(e => {
                console.error('–û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω:', path);
                // –ï—Å–ª–∏ —Ñ–∞–π–ª —Å —Ü–∏—Ñ—Ä–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä nameRIGHT1) –Ω–µ –Ω–∞–π–¥–µ–Ω, 
                // –ø—Ä–æ–±—É–µ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å—ã–≥—Ä–∞—Ç—å –±–µ–∑ —Ü–∏—Ñ—Ä—ã (nameRIGHT)
                if (finalFilename !== filename) {
                    new Audio('./audio/' + filename + '.wav').play().catch(() => {});
                }
            });
        }

        function playSyllable(consonant, vowel) {
            let filename;
            if (consonant === 'k') {
                filename = 'k_syllable_' + vowel; // Special handling inside playAudio
            } else {
                // ma1, na1 (default to 1)
                filename = consonant + vowel + '1';
            }
            playAudio(filename);
        }

        // --- NAVIGATION ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-' + id).classList.add('active');
        }

        function showMenu() {
            showScreen('menu');
        }

        function startApp(mode) {
            state.mode = mode;
            state.score = 0;
            state.currentIndex = 0;

            if (mode === 'lessons') {
                renderLesson();
                showScreen('lesson');
                return;
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞–Ω–∏–π
            state.queue = [];
            if (mode === 'sentences') {
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
                state.queue = [...sentencesData].sort(() => 0.5 - Math.random());
            } else if (mode === 'words') {
                // 10 —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–ª–æ–≤
                for(let i=0; i<10; i++) {
                    const word = dictionary[Math.floor(Math.random() * dictionary.length)];
                    // –¢–∏–ø: ru->mars –∏–ª–∏ mars->ru
                    state.queue.push({
                        type: 'word_trans',
                        dir: Math.random() > 0.5 ? 'ru_mars' : 'mars_ru',
                        data: word
                    });
                }
            } else if (mode === 'pronunciation') {
                 // 10 –∑–∞–¥–∞–Ω–∏–π: –Ω–∞–π–¥–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
                 for(let i=0; i<10; i++) {
                    const word = dictionary[Math.floor(Math.random() * dictionary.length)];
                    state.queue.push({
                        type: 'pronunciation',
                        data: word
                    });
                }
            }

            showScreen('quiz');
            renderQuestion();
        }

        // --- RENDERERS ---

        function renderQuestion() {
            const q = state.queue[state.currentIndex];
            const area = document.getElementById('questionArea');
            const progress = (state.currentIndex / state.queue.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            resetActionBar();

            if (state.mode === 'sentences') {
                if (q.type === 'construct') {
                    renderSentenceConstruct(q, area);
                } else if (q.type === 'audio_choice') {
                    renderSentenceChoice(q, area);
                }
            } else {
                renderWordQuiz(q, area);
            }
        }

        function renderSentenceConstruct(q, area) {
            state.currentSentenceBuild = [];
            
            // –°–æ–∑–¥–∞–µ–º –ø—É–ª —Å–ª–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ + 3 –ª–∏—à–Ω–∏—Ö)
            const allWords = [...dictionary.map(w => w.word)];
            const wrongWords = allWords.filter(w => !q.target.includes(w))
                                       .sort(() => 0.5 - Math.random())
                                       .slice(0, 3);
            
            let pool = [...q.target, ...wrongWords].sort(() => 0.5 - Math.random());

            let html = `
                <div class="prompt-text">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</div>
                <div class="target-word" style="font-size: 1.5rem;">${q.prompt}</div>
                ${q.audio ? `<button class="audio-btn" onclick="playAudio('${q.audio}')">üîä</button>` : ''}
                
                <div class="sentence-slot-area" id="slots"></div>
                
                <div class="word-bank" id="bank">
                    ${pool.map(word => `<div class="word-chip" onclick="moveWord(this, '${word}')">${word}</div>`).join('')}
                </div>
            `;
            area.innerHTML = html;
        }

        function moveWord(el, word) {
            const slots = document.getElementById('slots');
            const bank = document.getElementById('bank');
            
            if (el.parentElement === bank) {
                slots.appendChild(el);
                state.currentSentenceBuild.push(word);
            } else {
                bank.appendChild(el);
                const idx = state.currentSentenceBuild.indexOf(word);
                if (idx > -1) state.currentSentenceBuild.splice(idx, 1);
            }
        }

        function renderSentenceChoice(q, area) {
            state.selectedOptionIndex = -1;
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã (0 - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, 1 - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
            // –ù–æ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≤—è–∑—å —Å –∞—É–¥–∏–æ.
            // –°–æ–∑–¥–∞–¥–∏–º –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –æ–ø—Ü–∏–π
            const options = [
                { text: q.correctText, isCorrect: true, audio: q.correctAudio },
                { text: q.wrongText, isCorrect: false, audio: q.wrongAudio }
            ].sort(() => 0.5 - Math.random());

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏ –≤ —Å—Ç–µ–π—Ç, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
            state.currentOptions = options;

            let html = `
                <div class="prompt-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</div>
                <div class="target-word" style="font-size: 1.5rem;">${q.prompt}</div>
                
                <div class="options-grid">
                    ${options.map((opt, idx) => `
                        <div class="btn-option" onclick="selectOption(${idx}, '${opt.audio}')" id="opt-${idx}">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div style="width:20px; height:20px; border:2px solid #ccc; border-radius:50%;" class="radio-ind"></div>
                                <span>${opt.text}</span>
                                <span style="margin-left:auto; color:var(--secondary)">üîä</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            area.innerHTML = html;
        }

        function selectOption(idx, audioFile) {
            state.selectedOptionIndex = idx;
            document.querySelectorAll('.btn-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('opt-' + idx).classList.add('selected');
            if(audioFile) playAudio(audioFile);
        }

        function renderWordQuiz(q, area) {
            state.selectedOptionIndex = -1;
            const correctWord = q.data;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
            const wrongs = dictionary.filter(w => w.word !== correctWord.word)
                                     .sort(() => 0.5 - Math.random())
                                     .slice(0, 3);
            const options = [correctWord, ...wrongs].sort(() => 0.5 - Math.random());
            state.currentOptions = options; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

            let prompt, mainText;
            if (q.type === 'pronunciation') {
                prompt = "–ö–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—Å—è?";
                mainText = correctWord.word;
            } else if (q.dir === 'ru_mars') {
                prompt = "–ö–∞–∫ —ç—Ç–æ –Ω–∞ –º–∞—Ä—Å—Ä–∏—è–Ω—Å–∫–æ–º?";
                mainText = correctWord.translation;
            } else {
                prompt = "–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?";
                mainText = correctWord.word;
            }

            let html = `
                <div class="prompt-text">${prompt}</div>
                <div class="target-word">${mainText}</div>
                <div class="options-grid">
                    ${options.map((opt, idx) => {
                        let txt;
                        if (q.type === 'pronunciation') txt = opt.transcription;
                        else if (q.dir === 'ru_mars') txt = opt.word;
                        else txt = opt.translation;
                        
                        return `<div class="btn-option" onclick="selectSimpleOption(${idx})" id="opt-${idx}">
                            ${txt}
                        </div>`
                    }).join('')}
                </div>
            `;
            area.innerHTML = html;
        }

        function selectSimpleOption(idx) {
            state.selectedOptionIndex = idx;
            document.querySelectorAll('.btn-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('opt-' + idx).classList.add('selected');
        }

        // --- CHECK LOGIC ---

        function checkAnswer() {
            const q = state.queue[state.currentIndex];
            let isCorrect = false;
            let correctText = "";

            if (state.mode === 'sentences') {
                if (q.type === 'construct') {
                    // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤—ã
                    const answer = state.currentSentenceBuild.join(' ');
                    const target = q.target.join(' ');
                    isCorrect = (answer === target);
                    correctText = target;
                } else if (q.type === 'audio_choice') {
                    if (state.selectedOptionIndex === -1) return;
                    isCorrect = state.currentOptions[state.selectedOptionIndex].isCorrect;
                    correctText = q.correctText;
                }
            } else {
                // Words
                if (state.selectedOptionIndex === -1) return;
                const selected = state.currentOptions[state.selectedOptionIndex];
                isCorrect = (selected.word === q.data.word);
                
                if (q.type === 'pronunciation') correctText = q.data.transcription;
                else if (q.dir === 'ru_mars') correctText = q.data.word;
                else correctText = q.data.translation;
            }

            const bar = document.getElementById('actionBar');
            const msg = document.getElementById('feedbackMsg');
            
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';

            if (isCorrect) {
                bar.className = 'action-bar correct';
                msg.textContent = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3').play().catch(()=>{}); // Placeholder sound
                state.score++;
            } else {
                bar.className = 'action-bar wrong';
                msg.innerHTML = `–ù–µ–≤–µ—Ä–Ω–æ.<br>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctText}`;
                new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3').play().catch(()=>{});
            }
        }

        function nextQuestion() {
            state.currentIndex++;
            if (state.currentIndex >= state.queue.length) {
                showResults();
            } else {
                renderQuestion();
            }
        }

        function showResults() {
            showScreen('results');
            document.getElementById('resultText').textContent = 
                `–í—ã –Ω–∞–±—Ä–∞–ª–∏ ${state.score} –∏–∑ ${state.queue.length}`;
        }

        function resetActionBar() {
            const bar = document.getElementById('actionBar');
            bar.className = 'action-bar';
            document.getElementById('feedbackMsg').textContent = '';
            document.getElementById('checkBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
        }

        // --- LESSON LOGIC ---
        function renderLesson() {
            const grid = document.getElementById('syllableGrid');
            grid.innerHTML = '';

            syllablesData.consonants.forEach(cons => {
                syllablesData.vowels.forEach(vow => {
                    const cell = document.createElement('div');
                    cell.className = 'syllable-card';
                    cell.onclick = () => playSyllable(cons, vow);
                    cell.innerHTML = `
                        <div class="syllable-main">${cons}${vow}</div>
                        <div class="syllable-sub">/${cons}${vow}/</div>
                    `;
                    grid.appendChild(cell);
                });
            });
        }

        function setVoice(voice) {
            state.selectedVoice = voice;
            document.querySelectorAll('.voice-toggle').forEach(b => b.classList.remove('active'));
            document.getElementById('voice-' + voice).classList.add('active');
        }

    </script>
</body>
</html>
